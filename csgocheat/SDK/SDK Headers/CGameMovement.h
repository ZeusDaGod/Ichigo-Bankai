#pragma once
#include "stdafx.h"

class IMoveHelper
{
public:
	void SetHost( CBaseEntity* pPlayer )
	{
		typedef void (__thiscall* OriginalFn)( PVOID, CBaseEntity* pPlayer );
		getvfunc< OriginalFn >( this, 1 )( this, pPlayer );
	}

	bool m_bFirstRunOfFunctions : 1;
	bool m_bGameCodeMovedPlayer : 1;
	int m_nPlayerHandle; // edict index on server, client entity handle on client=
	int m_nImpulseCommand; // Impulse command issued.
	Vector m_vecViewAngles; // Command view angles (local space)
	Vector m_vecAbsViewAngles; // Command view angles (world space)
	int m_nButtons; // Attack buttons.
	int m_nOldButtons; // From host_client->oldbuttons;
	float m_flForwardMove;
	float m_flSideMove;
	float m_flUpMove;
	float m_flMaxSpeed;
	float m_flClientMaxSpeed;
	Vector m_vecVelocity; // edict::velocity // Current movement direction.
	Vector m_vecAngles; // edict::angles
	Vector m_vecOldAngles;
	float m_outStepHeight; // how much you climbed this move
	Vector m_outWishVel; // This is where you tried 
	Vector m_outJumpVel; // This is your jump velocity
	Vector m_vecConstraintCenter;
	float m_flConstraintRadius;
	float m_flConstraintWidth;
	float m_flConstraintSpeedFactor;
	float m_flUnknown[5];
	Vector m_vecAbsOrigin;
};

//class CPrediction
//{
//public:
//	void SetupMove(CBaseEntity *player, CInput::CUserCmd *ucmd, PVOID empty, PVOID moveData);
//	void FinishMove(CBaseEntity *player, CInput::CUserCmd *ucmd, PVOID moveData);
//};

class CGameMovement
{
public:
	void ProcessMovement( CBaseEntity* pPlayer, PVOID moveData )
	{
		typedef void (__thiscall* OriginalFn)( PVOID, CBaseEntity* pPlayer, PVOID moveData );
		getvfunc< OriginalFn >( this, 1 )( this, pPlayer, moveData );
	}

	void DecayPunchAngles()
	{
		typedef void (__thiscall* OriginalFn)( PVOID );
		getvfunc< OriginalFn >( this, 17 )( this );
	}
};


/*
i like anime a lot
................................ ....=I?+=========+??................. ..................... .. .. ..................... .. .. .............
. .............................~+========================~..................................................................................
............................?=============================,~+...............................................................................
.... ....................====================================..~............................................................................
.....   ..............?=====================================+....=..........................................................................
....................?==================================+:=+===~:...+........................................................................
..................================================+8+====,.===++:+=.=+......................................................................
....   .........++======================+=========+?Z+=+==...+++++++++=:....................................................................
.... .........,=======================8++==========OOZ++=.=+=.=++++++++++...................................................................
.............=======================+=ZO+========+ZZOOO+++++?+=+++++++++++..................................................................
............========================++ZZO+=+++++?ZZOZOOO=++++?+++++++++++++.................................................................
.... ......=========================++OOZOOOODO==++8Z8OO++++++7+++++++++++++= ..............................................................
..........+===================++++++++ZOOO$++++++++++++O+++++++I+++++++++++++,..............................................................
.........~=======+==+====++++++++++ZI=ZO$=++++++++++++++++++++++++++++++++++++..............................................................
.........++=====~+==++++++++++++++++7IO+?$++++++++I++++++++++++++++++++++++++++.............................................................
.... .. .=~=+:~,++==+=++++++++++++++Z78II?7?+++++++$++++++++++++++++++++++++7++~............................................................
.......:~====...+++:,~+=++++++++++++I++7I7II$++++++II++++++++++++?++++++++++??++............................................................
.... .....=+=.=:++I..?+++++++++++++++==+=I7777=++++?IO+++++++++++++I+++??++++?+?I...........................................................
.... .:~..+=+.++++I.+?+++++++++++++++7===+=7777?+++$77?++++++++++++++++I??+++7I++...........................................................
.... ...:.+++,=+++I++++++++++++++++$+7+=,~=+=$77$?+?777++++++++++++++++?I++++7$?+....... .~.................................................
.....~:.+:++++++++I7++7++++++++++++$+7==,,,:===$7$7++=77+++++++++++++I++++7?+777?:.... .OO..................................................
.....=+++++++++++?I?++$++++++++++++I++$=,,,,,,,=+=Z7+I++?+++?+++++++++?++7?I+7$7??....ZOO...................................................
.....++++++$+++++I7++++7+++++++++++7Z+7+,,,,,,,,:,=$7+,==+++++++++++++++?7Z7?7$Z$I..OOOO$...................................................
....=++++++?+++++77+?++D7+++++++?++7++7=:,,,,:,,,,,+$?,,~7+++I+++++?++?Z?$$I$7$O$IOOOOOO....................................................
....+++++++?+++I+77=:++7$I+++++++++7??I=~,,=,,,,,,,,+7:,,,+++??++++I++?+7$$Z$77$$ZZOOOZ.....................................................
....+?++++++$++?+77=,I++$7?++++++I+7Z$I~~?,,,,,,D88DDD888DI???I?+++?????$$$$$$$$7OOOOO, ....................................................
....++++++++7+++7+7=,,?+?=77?++++7?7$+??~,,,::88..OZ88+..$D+??7?????$????,,~$$$$$OZZO?.....           .  ............             .  .......
....++++++++I7++7+7+,,~++$I77+I++?7I$+$,~,,,88....$$$$O8 .$I++7?????II??$7~,,I$$OZZO?.......................................................
....+++++++++7++$77+~,,7+?+=777$$?$I$+?,,,,8Z ..?$$$I??O~.,,+????????$???7,,,,$$OO8???????$.................................................
....+I+?+?+++IZ+?77==,,,?I7==$777777$++:,,:O.. 877Z8$???O.,,+??$?????$I??$+,,,,88$$$$$$??+$....     ...  . ...  .   .  ....     ...  . ...
....+.+?++7?++77+77=+,,:,$77=+Z$77777++,,,=,...OI?Z$I??O.,,,???$?????7$??7$,,,,Z$ZZ$$$$$$$I?+...............................................
....+.++++??++7+++77=,,,,,+$$++,7$$$$+=,,,,,,...8?????8::,,,,??$??????$??I$=,,,Z$7?Z$$$$$$IO7?I.............................................
....+.:+7++$I?+7++7$+~,,,,,,Z7=+::=7$+=,,,,,,,,..8$8I::,::::,??ZI?????$$??$=,,,IO$??I$$$$$$$?:I?............................................
....+..++I+?$7+7?=?Z=+,,,,,,,,$7+,,,,,:,,,,,,,,,,,:,,,,.:::::??I$?7???$$??$I~,7Z.Z???I$$$$$I$?.,?:..  ..........................  ..........
....?...++I+IZ7?$=~+Z+,,,,,,,,,,:7,,,,,,,,,,,,,,,,,,,,:::::::??+$II???$O7?$Z+~$Z.=$??IIZ$$I$?7?..?..........................................
.....?..?+???7$$$$=,~=+,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,:::::,,I?+$?????Z$$?$$$$$$..$7I???ZZZ7I??,............................................
.....+...??II?$$$$+=,,+~,,,,,.,$,,,,,,,,,,,,,,,,,,,,,,,,,,,,,I?=Z??I??$$$I$$.Z$Z7.$8I???IZOI$Z?I......I.....................................
.....,....??Z$?$O$$==:,~:,,,,D?,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,I?=+??$??$$OZI$.ZZ$$.I~,????7.?$??Z.. ..?,,,...................................
......+....I?I$?$$7$=+,,::88D:,,,,,,~,,,,,,,,,,,,,,,,,,,,,,,,II=:??$??Z$7$I$.$$$Z.,..?????7..........,,,,:..................................
............,??$$$$O$IO88D=:,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,?=+,??$??$$,$?$.7$7$Z....???I?,.........,,,,,+.................................
..............$?Z$$$$ZZ+:::::,,,,,,,,,,,,,,,,:, $7,,,,,,,,,,:7=:,??$??$$.$I$..Z$7$....+???I? ........,,,,:,..................  .............
..............????O$$$$:?::::,,,,,,,,,,,,,,,??????I,,,,,,,,,,==,,??$??$Z.?$$..$$7Z$ ...I????I........,,~++,.................~,,=............
...............?????7Z$$:~:::,,,,,,,,,,,,$???=~~~~~:,,,,,,,,==,,=??$??$Z..$Z..?O$?Z7 ..=Z??Z?........,,+==+?...............,,,,=............
...............??????$$$Z:,,,,,,,,,,,,,O?=~~~~~~~~~~=,,,,,,::,,==I?$I7$:..$$...ZZZ7Z....7I$Z?........,,+=+=~..............=:++~I............
................?????$$$$:,,,,,,,,,,,,,~~~~~~~~~~~~~~,,,,,,,,,==+??$I$Z...$$...:ZZ7$Z...?$$O?........,,====:.............:,===:.............
................??????$$$$,,,,,,,,,,,,,7~~~~~~~~~~~~~,,,,,,,~===+??$IZ$...Z... ,??$???+?8$ZZ+........,,====,............,,==+=:.............
.................??I??$$$$O,,,,,,,,,,,,:=:~~~~~~~~~~,,,,,,,======I$$Z$....I..,?++7+++++++++$.........,,===+,..........?:,====,..............
.................IZ?7??$$$ZZ,,,,,,,,,,,,,7~~~~~~~~:,,,,,,~======+IZZZ~...,..+?+++?+++++++++?I........,,===+,........~,,,+=+=,...............
..................?????$$$$$Z$,,,,,,,,,,,,,=::,,,,,,,,,,+=======+?$$?....~7?++++?++++++++++++?I......,:===+= ......:,,,=+=+:................
..................?I?$??$$$Z$$ZZ~,,,,,,,,,,,,,,,,,,,,:===========OZ$..7?ZI+++++?7++++++++++++?+7$....,:====? ...:,,,,+=====.................
...................?.?$?I$$$Z$ZZZ..I:,,,,,,,,,,,,,,I++=========~$Z$,.?++??+++++?++++++++++?IZZ77I?+?.,~====...=,,,,=+=++7...................
...................I..IZ?$$$D.Z$7...$$ZZZI,,,,,,,+.=+========+,,Z:,,$+++?++++++??+++77I??+????++????Z:=====..:,,,=++=+=.....................
.................. ?..=$Z?ZZ$ZZOZ$...?7ZZ..........+====++==:,,:,,,,???+++++++++?++++++?++++++?+?++?:,=====.:,,:=+==+$=:I...................
...................7. .:ZZI$$8:Z$$$ .??7?$..........+=+=++,,,,,,,,+???+++++++++?+++++++++++?????I?==,,====:,,======$,,,,,,=.................
...................:.....$Z$$$Z+$$$O.I?I?$....  ....,=~,,,,,,,,:,?+??++++++++++??++++++++++++?$====$,,+==+======+Z+~,,,,,,,,~...............
..........................Z$$$ZZ$ZZ$$.7$$Z..:7??$..?:,,,,,,,,+,7++?I+++++?+++++?++++++?+?+++?====+$,,,+=============+=~,,,,,,,,?............
................... ........Z$$8?ZZ7?+++++?+++?++=,,,,,,,,I,,~?++++++++?++I++++??++++?I?+??======I,,,=+============++$?+=,,,,,,,,:,?~. .....
................... .........=Z$.I+++++++++?+??+=,,,,,,::,,,?+++??+++++=.++7+++?+++++??+O======+?,,,:=+=================I==+~,,,,,+,:$?.....
.....  ............  ..........~$+O?+++++++?+??=,,,,,,,,,:I??++7?+++++?.?+++$I++?++++???+======?,,,,++==================+=+Z=++++===++......
................................++?+++++++++++?$:,,,,,,,??+++???+++:++.:++++?Z77?++++??++===+=+,,,,=======================?==+++++,.........
...............................??+++++++++++I+++7,,,,,=?+?++$+?+??.+?+.++++++IO787?++??+====+:,,,,,=======================+$==~,,,,.........
...............................+??II?+++++++?7++++Z+Z?+??+7????++?.==.+?+++++77Z$777????+====,,,,,==========================,+=,,,,,........
......................... ....=+++Z77?++++++???++++++++?+?+....++?.,...+?++++7777$7777??O+++I,,,,,++======================+...=:,,,,+.......
..............................??+?7777+?????++++?II7??++++.,++=.+?..=+=..=?++I7777DI7777?778:,,,,,+I====================+=.....I,,,,,: .....
..............................?++I77777+ .....+..?+?+.=++.:??++.+?..+++??.+++?77777787$77$77,,,,,,+7==================+++.......?,,,,,......
......................   .....+++77Z777..+??+?+.???++.??~ +++++?++..+++++++++?7777777$$7777~,,,,,,++=================++=.........7,,,,,.....
.............................:+++777$7:.+++~++..++??..++..+++++,++:.+?++++++++I77777777Z77O,,,,,,+=+===++==I.:7$++==?,............+,,~::....
.............................I++?777$I.....~++.?+??,.+??..+++~.+++???++++++++++77777777$.$,,,,,,+=Z+++++I...........................I~,I....
............................$+???777Z..++?+++,.???,.I?+++.++..=+++++++++++++++?77777777+.,,,,,,=+I....   ............................. .....
............................=?7??777?.=++++++..+:..+?+++?+..=+?+++++++++++++++?7777777$.,,,,,,~+=...........................................
.............................?77?77$:.?+++++?+,.=++7+++???+??,.+?+++++++++++++?7777777+,,,,,,==.............................................
............................+?I7I+7+???+++++??+++++:.+?~.~?I:=777?+?++++++++++777777O,,,,,,,+=..............................................
...........................=?+?777??77777I??,.+++?:,.?+?I:::+7777777+++++++++?777777$,,,,,,=?...............................................
...........................?++?777$?77777777,..+?+:~.I7777::7777777?+++++++++?7777777.I,,,?.................................................
..........................7?+++?777+7777777I.~.?+.=~.77777:=77777??++++++++++7777777$.......................................................
..........................??++++777?777777I: +.=..?::?7777:I777?++++++++++++?7777777........................................................
.........................=+?+++7I77?77777??..?...++::??777~77++++++++++++++?7777777?........................................................
.....  ....... ..........7++7+I7777?7777+++.=++.~?++7++?777?+....+?++++++++?777777Z.........................................................
..........................+?+Z77777I?I++++++?+++?+??I=~+II+..++++?+++++++++777777$ .........................................................
..........................:+?+7O777O?++++++?+++?+?..,I+=+7..??++++++++++++I7777777..........................................................
................   ......+,,?777778O?++++?+..+?+?.=++?+?+?I:....:??+++++++777777Z:..........................................................
.........................,,,=Z777778++++?+.~.+?+?....:I??+??+?+?,.+++++++I777777$...........................................................
........................=,,,==++O77$+++++.,+.,++++++?+..?+??+++++.+++++++777777O?...........................................................
........................,,,===+++++?++++......?+++??+?=.?++:=:...~?++++?I7777777?...........................................................
............... .. ....:,,~+======8++++, ~?+=.?++.+++..~?+++~=++?+++++++777I?77?+...........................................................
.......................,,,=+=====++++++.???++.++++..,++++++?+++++++++++I777+?7$??...........................................................
....... ..............~,,========Z++?+.~+++++++++++++++++++++++++++++++777?+?77+?...........................................................
......................:,:=======++?++?++++++++++++++++++++++++++++++++I777?+I$+++...........................................................
.....................:,:+=====++=+++++++++++++++++++++++++++++++++++++777?+?77+++...........................................................
......................,=+=======Z+++++++++++++++++++++++++++++++++++?I777?+?77+++...........................................................
......................,:+=======I+++++++++++++++++++++++++++++++++++?777?++?7?+++...........................................................
......................+,========?+++++++++++++++++++++++++++++++++++I77I++++$?+++,..........................................................
............  .........,========?+++++++++++++++++++++++++++++++++++777++++?7?+++:..........................................................
.......................,,+++==+=?+++++++++++++++++++++++++++++++++++77?++++I?++++?..........................................................
.......................=,==+==+=?++++++++++++++++++++++++++++++++++?77+++++7?+++?Z..........................................................
........................:~======?++++++++++++++++++++++++++++++++++77?+++++I?++?7I..........................................................
.................. ......,=+====?++?+++++++++++++++++++++++++++++++7+?++++++?+++77$.........................................................
.....  .... ...    ... ..,======7++?++++++++++++++++++++++++++++++?I++++++?++++I77??........................................................
.......  .. ....   ..    .:+====Z+??++++++?++++++++++++++++++++++?7?++++++?+++?777+?+.......................................................
.....  . ..    .   ... ...I,===+I?$+++++?I+++++++++++++++++++++++??+++++++++++?7$I+?........................................................
..   ..  ..................,=I,,I?Z?+++++?+++++++++++++++++++++++I?+++++++++++77O??7~.......................................................
....   . ..    ...       ...,7,,,?Z++++?7?++++++++++++++++++++++++?++++++++++?7Z?+777.......................................................
.....   ...    ... ...... ..?,,,,,Z?+++I+?++++++++++++++++++++++?++++++++++++77?+I777$......................................................
..     . ......... ...... ...,=,,,=++??7+?+++++++++++++++++++++++++++++++++++77??77777$:....................................................
........ ..   .... ... ......,,:,,,?+?7I+++++++++++++++++++++++?+++++++++++?7$+?77777777:...................................................
........... .. ... ... .. ..=,,,I:=7+77++++++++++++++++++++++++++++++++++++?7?+77777777777..................................................
.....    ...   .  .... ... ..?,,,7$7777++++++++++++++++++++++++++++++++++++$?+?777777777777.................................................
. ...    ..    ...   .    ...,?,,,$?77++++++++++++++++++++++++++++++++++++7?++77777777777777?...............................................
..  .....     ..   .........~,,=,,,$7I+++++++++++++++++++++++++++++++++++7$+?777?++?+++++++++I..............................................
.... ... .. ..     ...... ..:,,,,,,O7+?+++++++++++++++++++++++++++++++++7$??7++++++++++++++++?+7............................................
.......  .. ..  ..   ........,I:,,~77+?+++++++++++++++++++++++++++++++?77?+I?++++++++++++++++++?+...........................................
.....  ....        ...    ...?,,:,,Z?++++++++++++++++++++++++++++++++?77?+??+++++++++++++++++++?7?..........................................
. ..........  ..  .... .. .....=,::Z+?++++++++++++++++++++++++++++++I77?++7?+++++++++++++++++?I?+??.........................................
... ..  .. .. ... ... .. ......~7~?I??++++++++++++++++++++++++++++I77?+?7?++++++++++++++++?++++++?+........................................
..     ..        ... ...... ..:??77++++++++++++++++++++++++++++?I77$++I?++++++++++++++++??+++++++?I.......................................
.....  . ..    ... ... .. ... ...I77+++++++++++++++++++++++++++++7777++++++++++++++++++?+++++++++++?+~......................................
....           .   .. .  .  . ...7II+++++++++++++++++++++++++++?777$+++++++++++++++++???++++++++++?==?......................................
. ...    ..   .    ...    .. .....??++++++++++++++++++++++++++?777I?++++++++++++++??I+++++++++++?+=+==I.....................................
.... ..  ..    ... ... ...........?+++++++++++++++++++++++++?777$?+++++++++++++?+??+++++++++++?=,,,,:=+=....................................
.....       .. .   ...   .........?++++++++++++++++++++++++?777??++++++++++++++I+?+++++++++??=,,,,,,,,:+=...................................
...........     .. ...............?+++++++++++++++++++++++777?+++++++++++++++7?++++++++++??:,,,,,,,,,,,,+...................................
..   ...... .. ...   . .. ..    ..++++++++++++++++++++++?77I?++++++++++++++I?+++++++++++I,:,,,,,,,,,,,,,,=..................................
....        .. .   ...............??+++++++++++++++++++77++?++++++++++++???++++++++++?I,,,,,,,,,,,,,,,,,,,?.................................
....... ..........................$++++++++?I???+?+??7++++++++++++++++I++++++++++?+?~,,,,,,,,,,,,,,,,,,,,,,.................................
... .. ...    ... ..     .. .=7?++++++++?777I7?+++++++++++++++??++++++++++++O+,,,,,,,,,,,,,,,,,,,,,,,,,................................
someone put me out of my missourri
*/